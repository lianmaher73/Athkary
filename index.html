<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>أجر</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-XR0YC1YREJ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-XR0YC1YREJ");
    </script>
    <script
      src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js"
      defer
    ></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function (OneSignal) {
        await OneSignal.init({
          appId: "73735103-3f37-478c-9d5c-f232c70ba8a6",
        });
      });
    </script>
    <script
      src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js"
      defer
    ></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function (OneSignal) {
        await OneSignal.init({
          appId: "73735103-3f37-478c-9d5c-f232c70ba8a6",
        });

        // ميزة الإشعار العشوائي عند الفتح
        // بنسحب كل الأذكار الموجودة في قسم العدادات
        if (typeof sectionsData !== "undefined") {
          const counters = Object.values(sectionsData["daily-counters"]);
          const randomDhikr =
            counters[Math.floor(Math.random() * counters.length)];

          // إرسال إشعار داخلي تذكيري
          OneSignal.Notifications.displaySelfContainedNotification({
            title: "تذكير بالخير ✨",
            body: `ما رأيك أن نكسب اليوم: ${randomDhikr.title}؟ - ${randomDhikr.btn}`,
            icon: "https://lianmaher73.github.io/Athkary/img/Logo.png",
          });
        }
      });
    </script>
    <style>
      /* [1] تعريف الألوان الأساسية - الوضع الفاتح */
      :root {
        --main-color: #4f1a2a; /* العنابي */
        --light-color: #fceffc; /* الوردي الفاتح */
        --dark-color: #2b0b15;
        --white: #ffffff;
        --text-color: #2b0b15;
      }

      /* [2] تعريف الألوان - الوضع الداكن */
      body.dark-theme {
        --main-color: #ffffff;
        --light-color: #4f1a2a;
        --white: #632537;
        --text-color: #ffffff;
      }

      /* تنسيقات عامة للجسم والخلفية */
      html {
        background-color: var(--main-color);
      }
      body {
        font-family: "Segoe UI", Tahoma, sans-serif;
        background-color: var(--light-color);
        color: var(--text-color);
        margin: 0;
        overflow-x: hidden;
        user-select: none;
        -webkit-user-select: none;
        transition: background-color 0.3s, color 0.3s;
        -webkit-tap-highlight-color: rgba(79, 26, 42, 0.2);
      }
      html,
      body {
        height: 100%;
        margin: 0;
        background-color: var(
          --light-color
        ); /* هذا السطر هو الذي يغير لون الفوتر للوردي */
      }

      /* [3] تنسيق رأس الصفحة (Header) */
      .header {
        background-color: var(--main-color);
        color: var(--white);
        padding: 0 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
        position: sticky;
        top: 0;
        z-index: 2000; /* أعلى من الإعدادات ليبقى زر الترس ظاهراً */
      }

      .header-side {
        width: 60px;
        cursor: pointer;
      }
      .header-center {
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        font-size: 1.2rem;
      }
      .back-btn {
        cursor: pointer;
        font-size: 24px;
        display: none;
        margin-left: 10px;
      }

      .container {
        max-width: 500px;
        margin: auto;
        padding: 20px;
        text-align: center;
      }

      /* [4] تنسيق شبكة الكروت (Grid) */
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 20px;
      }
      .card {
        background: var(--white);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        cursor: pointer;
      }
      .card-title {
        padding: 15px 10px;
        font-size: 18px;
        font-weight: bold;
        color: var(--main-color);
      }
      .card-action {
        background: var(--main-color);
        color: var(--light-color);
        padding: 10px;
        font-size: 14px;
        font-weight: bold;
      }

      /* [5] تصميم الإعدادات كلوحة علوية مستقلة (Settings Overlay) */
      #settings-page {
        display: none;
        position: fixed;
        top: 60px;
        left: 0;
        width: 100%;
        height: calc(100% - 60px);
        background-color: var(--light-color);
        z-index: 1500;
        padding: 20px;
        box-sizing: border-box;
        overflow-y: auto;
      }

      /* إخفاء الصفحات افتراضياً */
      #section-content-page,
      #sub-page,
      #feedback-page {
        display: none;
      }

      /* [6] تنسيق صفحة العداد والنص */
      .hadith-box {
        background: var(--white);
        padding: 15px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      .circle-frame {
        width: 250px;
        height: 250px;
        border: 10px solid var(--main-color);
        border-radius: 50%;
        margin: 60px auto;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--white);
        cursor: pointer;
        touch-action: manipulation;
      }
      #counter-display {
        font-size: 6.5rem;
        color: var(--main-color);
      }
      .highlight {
        background-color: var(--main-color);
        color: var(--light-color);
        padding: 2px 8px;
        border-radius: 5px;
        display: inline-block;
        margin: 2px;
      }

      /* [7] تنسيق الإعدادات والتذييل (Footer) */
      .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: var(--white);
        margin-bottom: 10px;
        border-radius: 12px;
        font-weight: bold;
        color: var(--main-color);
      }
      .footer {
        margin-top: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .reset-btn {
        background: var(--main-color);
        color: var(--light-color);
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
      }

      /* حقول الإدخال */
      input,
      textarea {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        background: var(--white);
        color: var(--text-color);
        margin-bottom: 15px;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div
        class="header-side"
        onclick="toggleSettings()"
        style="text-align: right"
      >
        <span id="settings-icon" class="material-symbols-outlined"
          >settings</span
        >
      </div>
      <div class="header-center">
        <div id="back-icon" class="back-btn" onclick="goBack()">→</div>
        <span id="page-title">أجر</span>
      </div>
      <div
        class="header-side"
        onclick="openFeedback()"
        style="font-size: 0.8rem; opacity: 0.9"
      >
        من أنا؟
      </div>
    </div>

    <div class="container">
      <div id="main-page">
        <p style="font-weight: bold; margin-bottom: 25px">
          بِقَدْرِ ذِكْرِكَ، يَعْلُو بُنيانك.. اختار وجهتك اليوم
        </p>
        <div class="grid">
          <div class="card" onclick="showSection('daily-counters')">
            <div class="card-title">العدادات اليومية</div>
            <div class="card-action">نخل، قصور، وكنوز</div>
          </div>
          <div class="card" onclick="showSection('morning-evening')">
            <div class="card-title">الصباح والمساء</div>
            <div class="card-action">كاملة ومختصرة</div>
          </div>
          <div class="card" onclick="showSection('treasures')">
            <div class="card-title">كنوز الأذكار</div>
            <div class="card-action">أحاديث عظيمة الأجر</div>
          </div>
          <div class="card" onclick="showSection('duaa')">
            <div class="card-title">جوامع الدعاء</div>
            <div class="card-action">أدعية مستجابة</div>
          </div>
        </div>
      </div>

      <div id="section-content-page">
        <div id="section-items-grid" class="grid"></div>
        <div id="daily-actions" class="footer" style="display: none">
          <span
            style="color: var(--main-color); font-weight: bold; cursor: pointer"
            onclick="showBalance()"
            >شاهد رصيدك</span
          >
          <button class="reset-btn" onclick="resetAll()">تصفير</button>
        </div>
      </div>

      <div id="sub-page">
        <div class="hadith-box">
          <p id="hadith-content"></p>
        </div>
        <div id="counter-area" class="circle-frame" onclick="increment()">
          <div id="counter-display">0</div>
        </div>
      </div>

      <div id="settings-page">
        <div class="setting-row">
          <span>الاهتزاز</span
          ><input type="checkbox" id="vibrate-toggle" checked />
        </div>
        <div class="setting-row">
          <span>الوضع الداكن</span
          ><input
            type="checkbox"
            id="dark-mode-toggle"
            onclick="toggleDarkMode()"
          />
        </div>
        <div
          style="
            background: var(--main-color);
            color: var(--light-color);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
          "
        >
          المجموع الكلي: <span id="total-sum">0</span>
        </div>
      </div>

      <div id="feedback-page">
        <h3 style="color: var(--main-color)">صدقة جارية.. اذكروني بدعوة</h3>
        <form
          id="suggestion-form"
          action="https://formspree.io/f/mlgrznlk"
          method="POST"
        >
          <input type="email" name="email" placeholder="إيميلك (اختياري)" />
          <textarea
            name="message"
            required
            placeholder="اكتب اقتراحك هنا..."
          ></textarea>
          <button
            type="submit"
            class="card-action"
            style="
              width: 100%;
              border: none;
              border-radius: 10px;
              cursor: pointer;
            "
          >
            إرسال
          </button>
        </form>
      </div>
    </div>

    <div
      id="balance-modal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 3000;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        style="
          background: var(--white);
          padding: 25px;
          border-radius: 20px;
          width: 80%;
          text-align: center;
        "
      >
        <h3 style="color: var(--main-color)">رصيدك من النعيم ✨</h3>
        <div
          id="balance-list"
          style="text-align: right; margin: 20px 0; line-height: 2"
        ></div>
        <button
          onclick="closeBalance()"
          class="card-action"
          style="width: 100%; border: none; border-radius: 10px"
        >
          تقبل الله
        </button>
      </div>
    </div>

    <script>
      /* =========================================
         [مكان الإضافة]: هنا يمكنكِ إضافة أذكار جديدة 
         =========================================
      */
      const sectionsData = {
        // أضيفي أذكار عداد جديدة هنا (تأكدي من وضع فاصلة بين كل ذكر)

        "daily-counters": {
          palm: {
            title: "نخلة",
            limit: 1,
            btn: "ازرع نخلة",
            text: "قال رسول الله ﷺ:<br> من قال: <span class='highlight'>سبحان الله العظيم وبحمده</span>، غرست له نخلة في الجنة",
          },
          palace: {
            title: "قصر",
            limit: 10,
            btn: "عمّر قصراً",
            text: "قال رسول الله ﷺ:<br> من قرأ <span class='highlight'>قُلْ هُوَ اللهُ أَحَدٌ</span> <span class='highlight'>عشرَ مراتٍ</span>، بنى اللهُ له قصراً في الجنَّةِ",
          },
          kanz: {
            title: "كنز",
            limit: 1,
            btn: "اجمع كنزاً",
            text: "قال رسول الله ﷺ:<br><span class='highlight'>لا حول ولا قوة إلا بالله</span> كنز من كنوز الجنة",
          },
          ghofran: {
            title: "غفران",
            limit: 100,
            btn: "غفران الخطايا",
            text: "قال رسول الله ﷺ:<br> من قال <span class='highlight'>سبحان الله وبحمده</span> <span class='highlight'>مائة مرة</span> غفرت خطاياه",
          },
          jwa2z: {
            title: "الخمسُ جوائز",
            limit: 100,
            btn: "5 جوائز في ذكر",
            text: "قال رسول الله ﷺ:<br>من قال <span class='highlight'>لا إله إلا الله وحده لا شريك له..</span> <span class='highlight'>مائة مرة</span>؛ كانت له عدل عشر رقاب...",
          },
          tree: {
            title: "شجر",
            limit: 1,
            btn: "ازرع شجر",
            text: "قال رسول الله ﷺ:<br> قل <span class='highlight'>سبحان الله والحمد لله ولا إله إلا الله والله أكبر</span> يغرس لك بكل واحدة شجرة",
          },
          ager: {
            title: "الذكرُ المضاعف",
            limit: 3,
            btn: "ضاعف حسناتك",
            text: "عن جويرية رضي الله عنها أن النبي ﷺ قال: لقد قلتُ بعدكِ أربع كلمات، <span class='highlight'>ثلاث مرات</span>... <span class='highlight'>سبحان الله وبحمده، عدد خلقه، ورضا نفسه، وزنة عرشه، ومداد كلماته</span>.",
          },
        },
        "morning-evening": {
          // [مكان إضافة أذكار الصباح والمساء]
        },
        treasures: {
          // أضيفي أحاديث طويلة (بدون عداد) هنا
          daily: {
            title: "خصلتان",
            isTreasure: true,
            btn: "أتريد الجنة؟",
            text: "عن النبي صلى الله عليه وسلم قال خصلتان أو خلتان لا يحافظ عليهما عبد مسلم إلا دخل الجنة هما يسير ومن يعمل بهما قليل <span class='highlight'>يسبح</span> في دبر كل صلاة <span class='highlight'>عشرا</span> <span class='highlight'>ويحمد عشرا</span> <span class='highlight'>ويكبر عشرا</span> فذلك خمسون ومائة باللسان وألف وخمس مائة في الميزان <span class='highlight'>ويكبر أربعا وثلاثين إذا أخذ مضجعه</span> <span class='highlight'>ويحمد ثلاثا وثلاثين</span> <span class='highlight'>ويسبح ثلاثا وثلاثين</span> فذلك مائة باللسان وألف في الميزان فلقد رأيت رسول الله صلى الله عليه وسلم يعقدها بيده قالوا يا رسول الله كيف هما يسير ومن يعمل بهما قليل قال يأتي أحدكم يعني الشيطان في منامه فينومه قبل أن يقوله ويأتيه في صلاته فيذكره حاجة قبل أن يقولها",
          },
        },
        duaa: {
          // [مكان إضافة الأدعية]
        },
      };

      // متغيرات الحالة
      let currentSection = "main";
      let currentType = "";
      let data = JSON.parse(localStorage.getItem("heavenData")) || {};

      /* وظيفة فتح/إغلاق الإعدادات بشكل مستقل (Toggle) */
      function toggleSettings() {
        const settingsPage = document.getElementById("settings-page");
        const icon = document.getElementById("settings-icon");

        if (settingsPage.style.display === "block") {
          settingsPage.style.display = "none";
          icon.innerText = "settings";
        } else {
          settingsPage.style.display = "block";
          icon.innerText = "close"; // تغيير الأيقونة لـ X عند الفتح
          // تحديث المجموع عند الفتح
          document.getElementById("total-sum").innerText = Object.values(
            data
          ).reduce((a, b) => a + b, 0);
        }
      }

      /* نظام الرجوع الذكي للتعامل مع الأقسام */
      function goBack() {
        // إذا كانت الإعدادات مفتوحة، نغلقها أولاً ونبقى في نفس الصفحة
        if (
          document.getElementById("settings-page").style.display === "block"
        ) {
          toggleSettings();
          return;
        }

        if (["sub-page", "feedback-page"].includes(currentSection)) {
          showSection(window.lastSection || "main");
        } else if (currentSection !== "main") {
          showMain();
        }
      }

      /* العودة للواجهة الرئيسية (الأقسام الأربعة) */
      function showMain() {
        currentSection = "main";
        hideAllPages();
        document.getElementById("main-page").style.display = "block";
        document.getElementById("back-icon").style.display = "none";
        document.getElementById("page-title").innerText = "أجر";
      }

      /* عرض قائمة الأذكار داخل قسم معين */
      function showSection(sectionId) {
        if (sectionId === "main") return showMain();
        currentSection = sectionId;
        window.lastSection = sectionId;
        hideAllPages();

        const grid = document.getElementById("section-items-grid");
        grid.innerHTML = "";
        const items = sectionsData[sectionId] || {};

        Object.keys(items).forEach((key) => {
          grid.innerHTML += `
            <div class="card" onclick="openDhikr('${key}', '${sectionId}')">
              <div class="card-title">${
                sectionId === "daily-counters"
                  ? '"' + (data[key] || 0) + '" '
                  : ""
              }${items[key].title}</div>
              <div class="card-action">${items[key].btn}</div>
            </div>`;
        });

        document.getElementById("section-content-page").style.display = "block";
        document.getElementById("daily-actions").style.display =
          sectionId === "daily-counters" ? "flex" : "none";
        document.getElementById("back-icon").style.display = "inline-block";

        // [تعديل للرجوع] إخبار المتصفح أننا انتقلنا لصفحة القسم
        window.history.pushState({ page: sectionId }, "", "");
      }

      function openDhikr(type, sectionId) {
        currentSection = "sub-page";
        currentType = type;
        hideAllPages();
        const dhikr = sectionsData[sectionId][type];
        document.getElementById("sub-page").style.display = "block";
        document.getElementById("hadith-content").innerHTML = dhikr.text;

        document.getElementById("counter-area").style.display = dhikr.isTreasure
          ? "none"
          : "flex";
        document.getElementById("counter-display").innerText = data[type] || 0;

        // [تعديل للرجوع] إخبار المتصفح أننا انتقلنا لصفحة الذكر
        window.history.pushState({ page: "sub-page" }, "", "");
      }
      /* زيادة العداد وحفظ البيانات */
      function increment() {
        data[currentType] = (data[currentType] || 0) + 1;
        document.getElementById("counter-display").innerText =
          data[currentType];
        if (document.getElementById("vibrate-toggle").checked)
          navigator.vibrate(40);
        localStorage.setItem("heavenData", JSON.stringify(data));
      }

      /* إخفاء جميع الصفحات لتبديل الواجهات */
      function hideAllPages() {
        [
          "main-page",
          "section-content-page",
          "sub-page",
          "feedback-page",
        ].forEach((id) => {
          document.getElementById(id).style.display = "none";
        });
      }

      /* عرض الرصيد الإجمالي لكل ما تم تسبيحه */
      function showBalance() {
        const list = document.getElementById("balance-list");
        list.innerHTML = "";
        Object.keys(data).forEach((k) => {
          let name = "";
          // البحث عن اسم الذكر البرمجي لعرضه للمستخدم
          Object.values(sectionsData).forEach((sec) => {
            if (sec[k]) name = sec[k].title;
          });
          if (data[k] > 0) list.innerHTML += `<div>✅ ${data[k]} ${name}</div>`;
        });
        document.getElementById("balance-modal").style.display = "flex";
      }

      /* تبديل الوضع الداكن */
      function toggleDarkMode() {
        const isDark = document.getElementById("dark-mode-toggle").checked;
        document.body.classList.toggle("dark-theme", isDark);
        localStorage.setItem("darkMode", isDark);
      }

      /* تصفير جميع العدادات */
      function resetAll() {
        if (confirm("هل تريد تصفير جميع العدادات؟")) {
          data = {};
          localStorage.setItem("heavenData", JSON.stringify(data));
          showSection("daily-counters");
        }
      }

      function closeBalance() {
        document.getElementById("balance-modal").style.display = "none";
      }

      /* فتح صفحة الاقتراحات */
      function openFeedback() {
        currentSection = "feedback-page";
        hideAllPages();
        document.getElementById("feedback-page").style.display = "block";
        document.getElementById("back-icon").style.display = "inline-block";
      }

      /* تحميل الإعدادات المحفوظة عند فتح التطبيق */
      window.addEventListener("load", () => {
        if (localStorage.getItem("darkMode") === "true") {
          document.getElementById("dark-mode-toggle").checked = true;
          document.body.classList.add("dark-theme");
        }
      });
      // الاستماع لزر الرجوع في الهاتف
      window.onpopstate = function (event) {
        // تنفيذ دالة الرجوع البرمجية عند الضغط على زر الموبايل
        goBack(true);
      };

      // تعديل بسيط على دالة goBack لتتوافق مع زر الهاتف
      // تأكدي من تحديث دالة goBack الموجودة عندك لتصبح هكذا:
      function goBack(isFromPhoneButton = false) {
        // إذا كانت الإعدادات مفتوحة، نغلقها ونبقى في الصفحة
        if (
          document.getElementById("settings-page").style.display === "block"
        ) {
          toggleSettings();
          // إذا كان الرجوع من زر الهاتف، نحتاج لتعويض السجل الذي حُذف
          if (isFromPhoneButton)
            window.history.pushState({ page: currentSection }, "", "");
          return;
        }

        if (["sub-page", "feedback-page"].includes(currentSection)) {
          showSection(window.lastSection || "main");
          // إذا رجعنا عن طريق سهم التطبيق، نحتاج لحذف سجل من تاريخ المتصفح
          if (!isFromPhoneButton) window.history.back();
        } else if (currentSection !== "main") {
          showMain();
          if (!isFromPhoneButton) window.history.back();
        }
      }
    </script>
  </body>
</html>
